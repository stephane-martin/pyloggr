# grok the nginx logs
if app_name == "nginx" {

    if grok("NGINX_OPEN_FAILED", "NGINX_NOT_FOUND", "NGINX_ACCESS_LOG") {
        addtag("nginx")
    }

    if "agent" in fields {
        useragent([agent])
    }

    if "client_ip" in fields {
        if geoip([client_ip]) {
            addtag("geolocated")
        }
    }
}


# grok the shorewall logs
if (facility=="kern") {
    if grok("SHOREWALL", "UFW") {
        addtag("firewall")
        if geoip([source_ip]) {
            addtag("geolocated")
        }
    }
}

if app_name == "sudo" {
    if grok("SUDO_SECURITY") {
        addtag("security")
    }
    grok("SUDO_NORMAL")
}


if app_name ~* "sshd" {
    if grok("SSHD_SECURITY") {
        addtag("security")
    }
    grok("SSHD_NORMAL")
}


if app_name == "dovecot" {
    if grok("DOVECOT_SECURITY") {
        addtag("security")
    }
    grok("DOVECOT")
}


if app_name ~* "postfix" {
    grok("POSTFIX", "POSTFIX_ERRORS")
}
